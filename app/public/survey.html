<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nerd Friend Finder</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
    <!-- <link rel="stylesheet" type="text/css" href="assets/css/style.css"> -->

    <!-- Survey source: http://www.armory.com/tests/nerd500.html -->
</head>
<body>
    <div class = "container">
        <div class='maintext'>
            <h2 class="font-weight-bold">Survey Questions</h2>
            <hr>
            <h3 class="font-weight-bold">About You</h3>
            <form id ="friendForm" method="POST" role='form'>
                <h5>Name (Required)</h5>
                <input type="text" style="width: 100%" name="userName" id="friendName" required>
                <h5>Link to Photo Image (Required)</h5>
                <input type="url" style="width: 100%" name="userImage" id="photo" required>
                <hr>
                <div id = "survey"></div>
                <button type="submit" class="btn btn-primary submit" data-toggle='modal' data-target='#friendModal'><i class="fas fa-check-square"></i> Submit</button>
            </div>
        </div>

        <!-- Modal -->
        <div id="friendModal" class="modal fade" role="dialog">
            <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                <h4 class="modal-title"></h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                <button type="button" class="btn" data-dismiss="modal">Close</button>
                </div>
            </div>
            </div>
        </div>


        <footer class="footer">
            <div class="container">
                <p><a href="/api/friends">API Friends Link</a> | <a href="https://github.com/vdelariva/FriendFinder">GitHub Repo</a></p>
            </div>
        </footer>
      
    </div>
    

<!-- jQuery 3.3.1 -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    
<!--Bootstrap JS-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>    

<!--Custom Javascript-->
<!-- <script src="./app.js"></script> -->

<script type="text/javascript">

// Survey Questions
// ____________________________________________________________________________________

var surveyQuestions = [

  "I like science fiction.",
  "I like to read technology news reports.",
  "I have played a lot of video games.",
  "I sometimes prefer fictional people to real ones.",
  "I spend recreational time researching topics others might find dry or overly rigorous.",
  "I spend more time at the library than any other public place.",
  "I like to play RPGs. (Ex. D&D)",
  "I can be socially awkward at times.",
  "I have started writing a novel.",
  "I care about super heroes."
]

// Main Function
// ____________________________________________________________________________________

displaySurvey();

// When form submit button pressed

$(".submit").on("click", function(event) {
    event.preventDefault();

    // Here we grab the form elements
    let newFriend = getsurveyAnswers()
    console.log(newFriend);

    $.post("/api/friends", newFriend,
    function(friendData) {
        console.log(`friendData: ${JSON.stringify(friendData)}`);

        findFriend(newFriend,friendData);
    });
});


// ____________________________________________________________________________________
// Functions
// ____________________________________________________________________________________

function displaySurvey () {

   // Display Survey

   for (var i = 0; i < surveyQuestions.length; i++) {
       $("#survey").append(
       `<h4 class="font-weight-bold">Question ${i+1}</h4>`
       +   `<h6>${surveyQuestions[i]}</h6>`
       +   `<select id = "q${i}" class="custom-select custom-select-sm" style="width: 15%">`
       +   `<option selected>Select an Option</option>`
       +   `<option value="1">1 (Strongly Disagree</option>`
       +   `<option value="2">2</option>`
       +   `<option value="3">3</option>`
       +   `<option value="4">4</option>`
       +   `<option value="5">5 (Strongly Agree)</option>`
       +   `</select><br><br>`
       );
   }
}

// ____________________________________________________________________________________

function getsurveyAnswers(){

    let scores = [];

    for ( var i=0; i<surveyQuestions.length; i++){
        scores[i] = $(`#q${i}`).val();
    }

    let friend = {
    friendName: $("#friendName").val().trim(),
    photo: $("#photo").val().trim(),
    scores: scores
    };

    // Reset the form
    $("form")[0].reset();
    return friend;
}
// ____________________________________________________________________________________

function findFriend(friend,friendData){
    let ix = 0;
    let friendScore = 4 * friendData.length;
    let c = []

    // Calculate friend score with each possible friend in the array
    // Don't compare with last added item since that's the current friend
    for (j=0; j<friendData.length-1; j++){
        c = friend.scores.map( (v, i)  =>{ return Math.abs(v - friendData[j].scores[i]); });
        console.log(`C: ${c}`);
        var sum = c.reduce((c, b) => { return c + b; }, 0);
        console.log(`sum: ${sum}`);
        if ( sum < friendScore) {
            friendScore = sum;
            ix = j;
        }
        console.log(`friendscore: ${friendScore} ix: ${ix}`);

        $(".modal-title").text(`${friendData[ix].friendName}`);
        $(".modal-body").html(`<img src="${friendData[ix].photo}" alt="New Friend">`);
    }
}

// ____________________________________________________________________________________

</script>

</body>
</html>